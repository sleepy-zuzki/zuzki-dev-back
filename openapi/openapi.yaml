openapi: 3.1.0
info:
  title: API - Health Check
  version: 1.0.0
  description: >
    Especificación del endpoint de verificación de salud del servicio, incluyendo
    el estado de la conexión a la base de datos.
servers:
  - url: http://localhost:{port}
    description: Servidor local
    variables:
      port:
        default: '3000'
  - url: https://api.ejemplo.com
    description: Servidor de producción
tags:
  - name: Health
    description: Endpoints de verificación de estado

paths:
  /v1/health:
    get:
      tags:
        - Health
      summary: Verifica el estado del servicio
      operationId: checkHealth
      responses:
        '200':
          description: Estado actual del servicio y de la base de datos
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthResponse'
              examples:
                ok:
                  summary: Servicio y base de datos operativos
                  value:
                    status: ok
                    uptime: 12345.67
                    timestamp: '2025-08-23T12:34:56.789Z'
                    database:
                      status: up
                      initialized: true
                      latencyMs: 8
                degraded:
                  summary: Servicio operativo pero base de datos no disponible
                  value:
                    status: degraded
                    uptime: 22345.12
                    timestamp: '2025-08-23T12:35:56.789Z'
                    database:
                      status: down
                      initialized: false
                      latencyMs: null
        '500':
          description: Error no controlado
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  timestamp:
                    type: string
                    format: date-time

components:
  schemas:
    HealthResponse:
      type: object
      required:
        - status
        - uptime
        - timestamp
        - database
      properties:
        status:
          type: string
          description: Estado global del servicio
          enum: [ok, degraded]
        uptime:
          type: number
          format: float
          description: Tiempo que el proceso ha estado activo en segundos
          minimum: 0
        timestamp:
          type: string
          format: date-time
          description: Momento ISO 8601 de la verificación
        database:
          $ref: '#/components/schemas/DatabaseHealth'

    DatabaseHealth:
      type: object
      required:
        - status
        - initialized
      properties:
        status:
          type: string
          description: Estado de la conexión a la base de datos
          enum: [up, down]
        initialized:
          type: boolean
          description: Indica si el DataSource de ORM está inicializado
        latencyMs:
          type: integer
          format: int64
          minimum: 0
          nullable: true
          description: Latencia medida para una consulta simple (en milisegundos), o null si no aplica
